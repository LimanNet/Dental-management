<?php	/******************************************************************************/	/***						Diagnosis Template				                ***/	/***							Диагнозы									***/	/******************************************************************************/	if(!$results['cat']){return;}	if( isset($_REQUEST['hidden']) ){		hidden($results);	}	else{		show($results);	}?><?phpfunction show($results){echo'<script>function chang(str){    $(".select").removeClass("select");    $("#l"+str).addClass("select");	$("#txtHint").load("'.$results['link'].'&hidden=on&id="+str);}$(document).ready(function(){	if($("div").is(".status")){		$(".success").addClass("select");		$(".success").delay(2000).slideUp(300);	}		});</script><script LANGUAGE="JavaScript"><!--function confirmSubmit(){var agree=confirm(	"Удаление данного элемента приведёт к нарушению отчётности!\n\n"	+"\tВы действительно желаете удалить этот Диагноз?");if (agree)	return true ;else	return false ;}// --></script><table border="1" width="100%"><thead>	Диагнозы';		if(isset($results['res'])){		if($results['res']=='success'){			echo'			<div class="status success">				<p>Операция выполнена успешно.</p>				<div class="tn-progress"></div>			</div>						';}		else{echo' | <b>' . $results['res'].'</b>';}	}echo'</thead><tbody>	<tr>		<td width="30%">';/***						Левая панель перечисления			                ***/ echo'		<div class="lists">			<table class="list">				<tr>					<th>Название</th>					<th>Сокр. наз.</th>					<th>Тип диагноза</th>				</tr>					<form>				';								if(!$results['list']){ echo "<tr><td>Диагнозов нет</td></tr>";}				else{					foreach( $results['list'] as $value ){						if($value['id']==$results['GETid']){							echo '<tr class="lis selected" onclick="chang(\''.$value['id'].'\')" id="l'.$value['id'].'" id="l'.$value['id'].'"> ';						}else{							echo '<tr onclick="chang(\''.$value['id'].'\')" id="l'.$value['id'].'" class="lis"> ';						}						echo '<td>'.$value['name_full'].'</td>';						echo "<td>".$value['name']."</td>";												// Имя в массиве diagnosis_type						if($value['id_diagnosis_type']){							echo "<td>";							foreach( $results['diagnosis_type']as$val ){								if($val['id']== $value['id_diagnosis_type']){echo $val['name'];}							}							echo "</td>";						}else{echo "<td></td>";}						echo "</tr></form>";					}				}			echo'			</table>			</div>			</td>		<td width="70%">';		/***						Правая панель		                ***/echo'<div id="txtHint">';								// Дополнительные данные				$res['print043'] = $results['print043'];				$res['diagnosis_type'] = $results['diagnosis_type'];				$res['illDestination'] = $results['illDestination'];								// Основные переменные				$res['link'] = $results['link'];				$res['sAct'] = $results['sAct'];				$res['id'] = isset($results['id']) ?  $results['id'] : null;				$res['cat'] = $results['cat'];									if(isset($results['GETid']) || isset($results['sAct'])){										if($res['id']){						if($res['id']['archived']){disabledForm($res);}						else{activeForm($res);}					}else{						newForm($res);					}									}				else{ topform($res); }				echo'			</div>		</td>	</tr></tbody></table>';}function hidden($results){echo'<div id="txtHint">';								// Дополнительные данные				$res['print043'] = $results['print043'];				$res['diagnosis_type'] = $results['diagnosis_type'];				$res['illDestination'] = $results['illDestination'];								// Основные переменные				$res['link'] = $results['link'];				$res['sAct'] = $results['sAct'];				$res['id'] = isset($results['id']) ?  $results['id'] : null;				$res['cat'] = $results['cat'];												if(isset($results['GETid']) || isset($results['sAct'])){					if($res['id']){						if($res['id']['archived']){disabledForm($res);}						else{activeForm($res);}					}else{						newForm($res);					}				}				else{ topform($res); }echo'</div>';				}	function topform($result){		echo '			<div class="actions button-container button-group">				<a class="button big" href="'.$result['link'].'&sAct=new">Новый диагноз</a>				<a class="button big" href="'.$result['link'].'&archive=off">Каталог</a>				<a class="button big" href="'.$result['link'].'&archive=on">Архив</a>			</div>			<br><hr><br>		';	}	function newForm($result){		echo '<form id="form" method="post" action="'.$result['link'].'&sAct=insert" >';		echo '<input type="hidden" formmethod="get" name="action" value="catalog" />';		echo '<input type="hidden" formmethod="get" name="cat" value="diagnosis" />';				echo '			<div class="actions button-container">				<a href="'.$result['link'].'&sAct=new" class="button primary icon add">Новый диагноз</a>    				<div class="button-group">					<input form="form" type="submit" value="Сохранить" class="button primary" />					<input form="form" type="reset" value="Отменить" class="button" />				</div>                        				<div class="button-group minor-group">					<a href="'.$result['link'].'" class="button">К списку</a>					<a href="./admin.php" class="button">Выйти</a>									</div>			</div>		';	echo '</form>';				echo '<hr>';		echo 'Полное название*:';			echo '<input name="name_full" form="form" type="text" size="100" required /><br/>';		echo 'Сокращённое название*:';			echo '<input name="diagnosis_kod" form="form" type="text" required /><br/>';		echo 'Шифр МКБ-10';			echo '<input name="name" form="form" type="text" required /><br/>';		echo 'Обозначение для печати карточки Ф-043*:';			echo '<select form="form" name="id_print_043" />';				echo '<option></option>';				foreach($result['print043'] as $value){						echo '<option value="'.$value['id'].'">'.$value['name'].' - '.$value['description'].'</option>';				}							echo '<select/><br/>';				echo 'Укажите тип диагноза*:';			echo '<select form="form" name="id_diagnosis_type" required>';				foreach($result['diagnosis_type'] as $value){						echo '<option value="'.$value['id'].'">'.$value['name'].'</option>';				}			echo '<select/><br/>';				echo '<fieldset>';		echo '<legend>Укажите области применения диагноза:</legend>';			foreach($result['illDestination'] as $value){				echo '<input form="form" type="checkbox" name="ids_ill_destination[]" value="'.$value['id'].'">'.$value['name'].'<Br>';			}		echo '</fieldset>';				echo 'Укажите соответствие диагноза диагнозу в международной классификации';			echo '<input form="form" type="text" name="world" /><br/>';	}		function activeForm($result){		// Кнопки управления		echo '<form id="form" method="post" action="'.$result['link'].'&id='. $result['id']['id'] .'&sAct=update">';						echo '			<div class="actions button-container">				<a href="'.$result['link'].'&sAct=new" class="button primary icon add">Новый диагноз</a>    				<div class="button-group">					<input form="form" type="submit" value="Сохранить изменения" class="button primary" />					<input form="form" type="reset" value="Отменить" class="button" />					<input form="form" type="submit" value="В архив" class="button" formaction="?action=catalog&cat='.$result['cat'].'&id='. $result['id']['id'] .'&sAct=update&archived=1" />					<a href="'.$result['link'].'&id='. $result['id']['id'] .'&sAct=delete" onclick="return confirmSubmit()" class="button danger">Удалить</a>				</div>                        				<div class="button-group minor-group">					<a href="'.$result['link'].'" class="button">К списку</a>					<a href="./admin.php" class="button">Выйти</a>									</div>			</div>		';					echo '</form>';		echo '<hr>';				echo '<input type="hidden" formmethod="get" name="id" value="'.$result['id']['id'].'" form="form" />';		echo 'Полное название';			echo '<input formmethod="post" type="text" name="name_full" value="'.$result['id']['name_full'].'" form="form" size="100" /><br/>';		echo 'Сокращённое название';			echo '<input formmethod="post" type="text" name="diagnosis_kod" value="'.$result['id']['diagnosis_kod'].'" form="form" /><br/>';		echo 'Шифр МКБ-10';			echo '<input type="text" name="name" value="'.$result['id']['name'].'" form="form" /><br/>';		echo 'Обозначение для печати карточки Ф-043';			echo '<select form="form" name="id_print_043">';				echo '<option></option>';				foreach($result['print043'] as $value){					if($value['id'] == $result['id']['id_print_043']){						echo '<option selected value="'.$value['id'].'">'.$value['name'].' - '.$value['description'].'</option>';					}else{						echo '<option value="'.$value['id'].'">'.$value['name'].' - '.$value['description'].'</option>';					}				}							echo '<select/><br/>';		echo 'Укажите тип диагноза*:';			echo '<select form="form" name="id_diagnosis_type" required>';				foreach($result['diagnosis_type'] as $value){					if($value['id'] == $result['id']['id_diagnosis_type']){						echo '<option selected value="'.$value['id'].'">'.$value['name'].'</option>';					}else{						echo '<option value="'.$value['id'].'">'.$value['name'].'</option>';					}				}			echo '<select/><br/>';				echo '<fieldset>';		echo '<legend>Укажите области применения диагноза:</legend>';						$result['id']['ids_ill_destination'] = explode(",", $result['id']['ids_ill_destination']);						foreach($result['illDestination'] as $value){				if( in_array($value['id'],$result['id']['ids_ill_destination']) ){					echo '<input name="ids_ill_destination[]" checked form="form" type="checkbox" value="'.$value['id'].'" >'.$value['name'].'<Br>';				}else{					echo '<input name="ids_ill_destination[]" form="form" type="checkbox" value="'.$value['id'].'">'.$value['name'].'<Br>';				}			}		echo '</fieldset>';				echo 'Укажите соответствие диагноза диагнозу в международной классификации';			echo '<input form="form" type="text" name="world" value="'.$result['id']['world'].'" /><br/>';	}		function disabledForm($result){		// Кнопки управления		echo '<form id="form" method="post" action="'.$result['link'].'&id='. $result['id']['id'] .'&sAct=update">';		echo '<input type="hidden" name="archived" value="" form="form" />';		echo '<input type="hidden" formmethod="get" name="id" value="'.$result['id']['id'].'" form="form" />';		echo '			<div class="actions button-container">				<a href="'.$result['link'].'&sAct=new&archive=off" class="button primary icon add">Новый диагноз</a>    				<div class="button-group">					<input form="form" type="submit" value="Восстановить" class="button" formaction="'.$result['link'].'&id='. $result['id']['id'] .'&sAct=update" />					<a href="'.$result['link'].'&id='. $result['id']['id'] .'&sAct=delete" onclick="return confirmSubmit()" class="button danger">Удалить</a>				</div>                        				<div class="button-group minor-group">					<a href="'.$result['link'].'" class="button">К списку</a>					<a href="./admin.php" class="button">Выйти</a>									</div>			</div>		';					echo '</form>';		echo '<hr>';		foreach($result['id']as$param=>$value){			if($param!='archived'){echo '<input type="hidden" name="'.$param.'" value="'.$value.'" form="form" />';}		}		echo '<input type="hidden" formmethod="get" name="id" value="'.$result['id']['id'].'" form="form" />';		echo 'Полное название';			echo '<input disabled type="text" size="100" value="'.$result['id']['name_full'].'" /><br/>';		echo 'Сокращённое название';			echo '<input disabled type="text" value="'.$result['id']['diagnosis_kod'].'" /><br/>';		echo 'Шифр МКБ-10';			echo '<input disabled type="text" value="'.$result['id']['name'].'" /><br/>';		echo 'Обозначение для печати карточки Ф-043';			echo '<select disabled />';				echo '<option></option>';				foreach($result['print043'] as $value){					if($value['id'] == $result['id']['id_print_043']){						echo '<option selected value="'.$value['id'].'">'.$value['name'].' - '.$value['description'].'</option>';					}else{						echo '<option value="'.$value['id'].'">'.$value['name'].' - '.$value['description'].'</option>';					}				}							echo '<select/><br/>';		echo 'Укажите тип диагноза*:';			echo '<select disabled>';				foreach($result['diagnosis_type'] as $value){					if($value['id'] == $result['id']['id_diagnosis_type']){						echo '<option selected value="'.$value['id'].'">'.$value['name'].'</option>';					}else{						echo '<option value="'.$value['id'].'">'.$value['name'].'</option>';					}				}			echo '<select/><br/>';				echo '<fieldset>';		echo '<legend>Укажите области применения диагноза:</legend>';						$result['id']['ids_ill_destination'] = explode(",", $result['id']['ids_ill_destination']);						foreach($result['illDestination'] as $value){				if( in_array($value['id'],$result['id']['ids_ill_destination']) ){					echo '<input disabled checked type="checkbox" value="'.$value['id'].'" >'.$value['name'].'<Br>';				}else{					echo '<input disabled type="checkbox" value="'.$value['id'].'">'.$value['name'].'<Br>';				}			}		echo '</fieldset>';				echo 'Укажите соответствие диагноза диагнозу в международной классификации';			echo '<input disabled type="text" value="'.$result['id']['world'].'" /><br/>';	}?>